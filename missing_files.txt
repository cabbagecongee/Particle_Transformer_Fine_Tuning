# Delete the bad file (if you haven't already)
rm /mnt/data/jet_data/Res34P_0023.parquet

# Move into the jet_data directory
cd /mnt/data/jet_data

# Extract just the filenames from full URLs
basename -a $(cat filelist.txt) > all_files.txt

# List already-downloaded files
ls *.parquet > downloaded_files.txt

# Identify missing files (files not downloaded at all)
comm -23 <(sort all_files.txt) <(sort downloaded_files.txt) > missing_files.txt

# Identify corrupted files (<100MB)
find . -name '*.parquet' -size -100M > zero_files.txt
basename -a $(cat zero_files.txt) > corrupt_files.txt

# Combine both
cat missing_files.txt corrupt_files.txt | sort | uniq > to_download.txt

# Extract their download URLs
grep -F -f to_download.txt filelist.txt > urls_to_download.txt

# Download the missing + corrupted files
wget -c -i urls_to_download.txt -P .

kubectl exec -it -n cms-ml <pod_name> -- bash
kubectl exec <POD_NAME> -it -- bash

# save into /mnt/data/jet_data
wget -c -i filelist.txt -P /mnt/data/jet_data
